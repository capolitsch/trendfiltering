<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Optimize the trend filtering hyperparameter by minimizing Stein's unbiased
risk estimate — sure_trendfilter • trendfiltering</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Optimize the trend filtering hyperparameter by minimizing Stein's unbiased
risk estimate — sure_trendfilter" />
<meta property="og:description" content="For every candidate hyperparameter value, compute an unbiased estimate of the
trend filtering model's predictive mean-squared error. See the details
section for guidelines on when sure_trendfilter() should be used versus
cv_trendfilter()." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">trendfiltering</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../papers.html">Papers</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/capolitsch/trendfiltering">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Optimize the trend filtering hyperparameter by minimizing Stein's unbiased
risk estimate</h1>
    <small class="dont-index">Source: <a href='https://github.com/capolitsch/trendfiltering/blob/main/R/sure_trendfilter.R'><code>R/sure_trendfilter.R</code></a></small>
    <div class="hidden name"><code>sure_trendfilter.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>For every candidate hyperparameter value, compute an unbiased estimate of the
trend filtering model's predictive mean-squared error. See the details
section for guidelines on when <code>sure_trendfilter()</code> should be used versus
<code><a href='cv_trendfilter.html'>cv_trendfilter()</a></code>.</p>
    </div>

    <pre class="usage"><span class='fu'>sure_trendfilter</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span>, <span class='va'>weights</span>, k <span class='op'>=</span> <span class='fl'>2L</span>, nlambdas <span class='op'>=</span> <span class='fl'>250L</span>, <span class='va'>optimization_params</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>Vector of observed values for the input variable.</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>Vector of observed values for the output variable.</p></td>
    </tr>
    <tr>
      <th>weights</th>
      <td><p>(Optional) Weights for the observed outputs, defined as the
reciprocal variance of the additive noise that contaminates the output
signal. When the noise is expected to have an equal variance,
\(\sigma^2\), for all observations, a scalar can be passed to <code>weights</code>,
namely <code>weights = </code>\(1/\sigma^2\). Otherwise, <code>weights</code> must be a vector
with the same length as <code>x</code> and <code>y</code>.</p></td>
    </tr>
    <tr>
      <th>k</th>
      <td><p>Degree of the polynomials that make up the piecewise-polynomial
trend filtering estimate. Defaults to <code>k = 2</code> (i.e. a piecewise quadratic
estimate). Must be one of <code>k = 0,1,2</code>. Higher order polynomials are
disallowed since their smoothness is indistinguishable from <code>k = 2</code> and
their use can lead to instability in the convex optimization.</p></td>
    </tr>
    <tr>
      <th>nlambdas</th>
      <td><p>Number of hyperparameter values to test during validation.
Defaults to <code>nlambdas = 250</code>. The hyperparameter grid is internally
constructed to span the full trend filtering model space lying by a global
polynomial solution (i.e. a power law) and an interpolating solution, with
<code>nlambdas</code> controlling the granularity of the model space that is</p></td>
    </tr>
    <tr>
      <th>optimization_params</th>
      <td><p>(Optional) A named list of parameter values to be
passed to the trend filtering ADMM algorithm of
<a href='http://www.stat.cmu.edu/~ryantibs/papers/fasttf.pdf'>Ramdas and Tibshirani (2016)</a>, which is implemented in
the <code>glmgen</code> R package. See the <code><a href='https://rdrr.io/pkg/glmgen/man/trendfilter.control.list.html'>glmgen::trendfilter.control.list()</a></code>
documentation for a full list of the algorithm's parameters. The default
parameter choices will almost always suffice, but when adjustments do need to
be made, one can do so without any technical understanding of the ADMM
algorithm. In particular, the four parameter descriptions below should serve
as sufficient working knowledge.</p><dl>
<dt>obj_tol</dt><dd><p>A stopping threshold for the ADMM algorithm. If the relative
change in the algorithm's cost functional between two consecutive steps is
less than <code>obj_tol</code>, the algorithm terminates. The algorithm's termination
can also result from it reaching the maximum tolerable iterations set
by the <code>max_iter</code> parameter (see below). The <code>obj_tol</code> parameter defaults to
<code>obj_tol = 1e-10</code>. The <code>cost_functional</code> vector, returned within the
<code>sure_trendfilter()</code> output, gives the relative change in the trend filtering
cost functional over the algorithm's final iteration, for every candidate
hyperparameter value.</p></dd>
<dt>max_iter</dt><dd><p>Maximum number of ADMM iterations that we will tolerate.
Defaults to <code>max_iter = length(y)</code>. The actual number of iterations performed
by the algorithm, for every candidate hyperparameter value, is returned in
the <code>n_iter</code> vector, within the <code>sure_trendfilter()</code> output. If any of the
elements of <code>n_iter</code> are equal to <code>max_iter</code>, the tolerance defined by
<code>obj_tol</code> has not been attained and <code>max_iter</code> may need to be increased.</p></dd>
<dt>thinning</dt><dd><p>Logical. If <code>thinning = TRUE</code>, then the data are preprocessed
so that a smaller data set is used to fit the trend filtering estimate, which
will ease the ADMM algorithm's convergence. This can be
very useful when a signal is so well-sampled that very little additional
information / predictive accuracy is gained by fitting the trend filtering
estimate on the full data set, compared to some subset of it. See the
<code><a href='cv_trendfilter.html'>cv_trendfilter()</a></code> examples for a case study of this nature. When nothing
is passed to <code>thinning</code>, the algorithm will automatically detect whether
thinning should be applied. This preprocessing procedure is controlled by the
<code>x_tol</code> parameter below.</p></dd>
<dt>x_tol</dt><dd><p>Controls the automatic detection of when thinning should be
applied to the data. If we make bins of size <code>x_tol</code> and find at least two
elements of <code>x</code> that fall into the same bin, then the data is thinned.</p></dd>
</dl></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <code>'sure_tf'</code>. This is a list with the following
elements:</p><dl>
<dt>lambdas</dt><dd><p>Vector of candidate hyperparameter values (always returned in
descending order).</p></dd>
<dt>edfs</dt><dd><p>Number of effective degrees of freedom in the trend filtering
estimator, for every hyperparameter value in <code>lambdas</code>.</p></dd>
<dt>errors</dt><dd><p>Vector of mean-squared prediction errors estimated by SURE, for
every hyperparameter value in <code>lambdas</code>.</p></dd>
<dt>se_errors</dt><dd><p>Vector of estimated standard errors for the <code>errors</code>.</p></dd>
<dt>lambda_min</dt><dd><p>Hyperparameter value that minimizes the SURE validation
error curve.</p></dd>
<dt>lambda_1se</dt><dd><p>The largest hyperparameter value (corresponding to the
smoothest trend filtering estimate) that yields a SURE error within
one standard error of <code><a href='https://rdrr.io/r/base/Extremes.html'>min(errors)</a></code>. We call this the
"1-standard-error rule" hyperparameter, and it serves as an Occam's
razor-esque heuristic. That is, given two models with approximately equal
performance (here, in terms of MSE), it may be wise to opt for the simpler
model, i.e. the model with fewer effective degrees of freedom.</p></dd>
<dt>edf_min</dt><dd><p>Number of effective degrees of freedom in the minimum-SURE
trend filtering estimator.</p></dd>
<dt>edf_1se</dt><dd><p>Number of effective degrees of freedom in the 1-stand-error
rule trend filtering estimator.</p></dd>
<dt>i_min</dt><dd><p>Index of <code>lambdas</code> that minimizes the SURE error curve.</p></dd>
<dt>i_1se</dt><dd><p>Index of <code>lambdas</code> that gives the 1-standard-error rule
hyperparameter.</p></dd>
<dt>cost_functional</dt><dd><p>The relative change in the cost functional over the
ADMM algorithm's final iteration, for every candidate hyperparameter in
<code>lambdas</code>.</p></dd>
<dt>n_iter</dt><dd><p>Total number of iterations taken by the ADMM algorithm, for
every candidate hyperparameter in <code>lambdas</code>. If an element of <code>n_iter</code>
is exactly equal to <code>max_iter</code>, then the ADMM algorithm stopped before
reaching the tolerance set by <code>obj_tol</code>. In these cases, you may need
to increase <code>max_iter</code> to ensure the trend filtering solution has
converged to satisfactory precision.</p></dd>
<dt>training_errors</dt><dd><p>In-sample mean-squared error between the observed
outputs <code>y</code> and the trend filtering estimate, for every hyperparameter value
in <code>lambdas</code>.</p></dd>
<dt>optimisms</dt><dd><p>SURE-estimated optimisms, i.e.
<code>optimisms = errors - training_errors</code>.</p></dd>
<dt>tf_model</dt><dd><p>A list of objects that is used internally by other
functions that operate on the <code>'sure_tf'</code> object.</p></dd>

</dl>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Our recommendations for when to use <code><a href='cv_trendfilter.html'>cv_trendfilter()</a></code> versus
<code>sure_trendfilter()</code> are shown in the table below.</p><table class='table'>
<tr><td>Scenario</td><td>Hyperparameter optimization</td></tr>
<tr><td><code>x</code> is unevenly sampled</td><td><code><a href='cv_trendfilter.html'>cv_trendfilter()</a></code></td></tr>
<tr><td><code>x</code> is evenly sampled and reciprocal variances are not available</td><td><code><a href='cv_trendfilter.html'>cv_trendfilter()</a></code></td></tr>
<tr><td><code>x</code> is evenly sampled and reciprocal variances are available</td><td><code>sure_trendfilter()</code></td></tr>
</table>



<p>For our purposes, an evenly sampled data set with some discarded pixels
(either sporadically or in large consecutive chunks) is still considered to
be evenly sampled. When the inputs are evenly sampled on a transformed scale,
we recommend transforming to that scale and carrying out the full trend
filtering analysis on that scale. See the example below for a case when the
inputs are evenly sampled on the <code><a href='https://rdrr.io/r/base/Log.html'>log10(x)</a></code> scale.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p><b>Companion references</b></p><ol>
<li><p>Politsch et al. (2020a).
<a href='https://academic.oup.com/mnras/article/492/3/4005/5704413'>
Trend filtering – I. A modern statistical tool for time-domain astronomy and
astronomical spectroscopy</a>. <em>MNRAS</em>, 492(3), p. 4005-4018. <br /></p></li>
<li><p>Politsch et al. (2020b).
<a href='https://academic.oup.com/mnras/article/492/3/4019/5704414'>
Trend Filtering – II. Denoising astronomical signals with varying degrees of
smoothness</a>. <em>MNRAS</em>, 492(3), p. 4019-4032.</p></li>
</ol>

<p><b>Stein's unbiased risk estimate</b></p><ol>
<li><p>Tibshirani and Wasserman (2015).
<a href='http://www.stat.cmu.edu/~larry/=sml/stein.pdf'>Stein’s Unbiased Risk
Estimate</a>. <em>36-702: Statistical Machine Learning course notes</em>
(Carnegie Mellon University). <br /></p></li>
<li><p>Efron (2014).
<a href='https://www.tandfonline.com/doi/abs/10.1198/016214504000000692'>
The Estimation of Prediction Error: Covariance Penalties
and Cross-Validation</a>. <em>Journal of the American Statistical
Association</em>. 99(467), p. 619-632. <br /></p></li>
<li><p>Stein (1981).
<a href='https://projecteuclid.org/journals/annals-of-statistics/volume-9/issue-6/Estimation-of-the-Mean-of-a-Multivariate-Normal-Distribution/10.1214/aos/1176345632.full'>
Estimation of the Mean of a Multivariate Normal Distribution</a>.
<em>The Annals of Statistics</em>. 9(6), p. 1135-1151.</p></li>
</ol>

<p><b>Effective degrees of freedom for trend filtering</b></p><ol>
<li><p>Tibshirani and Taylor (2012).
<a href='https://projecteuclid.org/journals/annals-of-statistics/volume-40/issue-2/Degrees-of-freedom-in-lasso-problems/10.1214/12-AOS1003.full'>
Degrees of freedom in lasso problems</a>. <em>The Annals of Statistics</em>,
40(2), p. 1198-1232.</p></li>
</ol>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='cv_trendfilter.html'>cv_trendfilter()</a></code>, <code><a href='bootstrap_trendfilter.html'>bootstrap_trendfilter()</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>quasar_spectrum</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>spec</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span style='color: #949494;'># A tibble: 6 × 3</span>
#&gt;   log10_wavelength   flux weights
#&gt;              <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span>  <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span>   <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span>
#&gt; <span style='color: #BCBCBC;'>1</span>             3.55  0.424  0.041<span style='text-decoration: underline;'>7</span>
#&gt; <span style='color: #BCBCBC;'>2</span>             3.55 -<span style='color: #BB0000;'>2.11</span>   0.125 
#&gt; <span style='color: #BCBCBC;'>3</span>             3.55 -<span style='color: #BB0000;'>3.78</span>   0.128 
#&gt; <span style='color: #BCBCBC;'>4</span>             3.55  3.60   0.121 
#&gt; <span style='color: #BCBCBC;'>5</span>             3.55 -<span style='color: #BB0000;'>4.89</span>   0.134 
#&gt; <span style='color: #BCBCBC;'>6</span>             3.55  1.76   0.132 </div><div class='input'>
<span class='va'>sure_tf</span> <span class='op'>&lt;-</span> <span class='fu'>sure_trendfilter</span><span class='op'>(</span><span class='va'>spec</span><span class='op'>$</span><span class='va'>log10_wavelength</span>, <span class='va'>spec</span><span class='op'>$</span><span class='va'>flux</span>, <span class='va'>spec</span><span class='op'>$</span><span class='va'>weights</span><span class='op'>)</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Collin A. Politsch.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


