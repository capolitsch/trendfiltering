<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Optimize the trend filtering hyperparameter by minimizing Stein's unbiased
risk estimate — sure_trendfilter • trendfiltering</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Optimize the trend filtering hyperparameter by minimizing Stein's unbiased
risk estimate — sure_trendfilter" />
<meta property="og:description" content="For every candidate hyperparameter value, compute an unbiased estimate of the
trend filtering model's predictive mean-squared error. See the Details
section for guidelines on when sure_trendfilter() should be used versus
cv_trendfilter(). Generic functions such as predict(),
fitted.values(), and residuals() may be called on the
sure_trendfilter() output." />
<meta property="og:image" content="https://capolitsch.github.io/trendfiltering/logo.svg" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">trendfiltering</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../papers.html">Papers</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/capolitsch/trendfiltering">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Optimize the trend filtering hyperparameter by minimizing Stein's unbiased
risk estimate</h1>
    <small class="dont-index">Source: <a href='https://github.com/capolitsch/trendfiltering/blob/main/R/hyperparameter-tuning.R'><code>R/hyperparameter-tuning.R</code></a></small>
    <div class="hidden name"><code>sure_trendfilter.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>For every candidate hyperparameter value, compute an unbiased estimate of the
trend filtering model's predictive mean-squared error. See the <strong>Details</strong>
section for guidelines on when <code>sure_trendfilter()</code> should be used versus
<code><a href='cv_trendfilter.html'>cv_trendfilter()</a></code>. Generic functions such as <code><a href='https://rdrr.io/r/stats/predict.html'>predict()</a></code>,
<code><a href='https://rdrr.io/r/stats/fitted.values.html'>fitted.values()</a></code>, and <code><a href='https://rdrr.io/r/stats/residuals.html'>residuals()</a></code> may be called on the
<code>sure_trendfilter()</code> output.</p>
    </div>

    <pre class="usage"><span class='fu'>sure_trendfilter</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span>, <span class='va'>weights</span>, nlambda <span class='op'>=</span> <span class='fl'>250L</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>Vector of observed values for the input variable.</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>Vector of observed values for the output variable.</p></td>
    </tr>
    <tr>
      <th>weights</th>
      <td><p>Weights for the observed outputs, defined as the reciprocal variance of the
additive noise that contaminates the output signal. When the noise is
expected to have an equal variance <em></em>\(\sigma^2\) for all observations,
a scalar may be passed to <code>weights</code>, i.e. <code>weights = </code><em></em>\(1/\sigma^2\).
Otherwise, <code>weights</code> must be a vector with the same length as <code>x</code> and <code>y</code>.</p></td>
    </tr>
    <tr>
      <th>nlambda</th>
      <td><p>Number of hyperparameter values to test during cross validation. Defaults
to <code>nlambda = 250</code>. The hyperparameter grid is internally constructed to
span the full trend filtering model space (which is bookended by a global
polynomial solution and an interpolating solution), with <code>nlambda</code>
controlling the granularity of the hyperparameter grid.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional named arguments to pass to <code><a href='.trendfilter.html'>.trendfilter()</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class '<code>sure_trendfilter</code>' and subclass
'<code><a href='trendfilter.html'>trendfilter</a></code>'. This is a list with the elements below,
as well as all elements from the '<code><a href='trendfilter.html'>trendfilter</a></code>' call.</p><dl>
<dt><code>lambda</code></dt><dd><p>Vector of candidate hyperparameter values (always returned
in descending order).</p></dd>
<dt><code>edf</code></dt><dd><p>Number of effective degrees of freedom in the trend filtering
estimator, for every hyperparameter value in <code>lambda</code>.</p></dd>
<dt><code>error</code></dt><dd><p>Vector of mean-squared prediction errors estimated by SURE,
for every hyperparameter value in <code>lambda</code>.</p></dd>
<dt><code>se_error</code></dt><dd><p>Vector of estimated standard errors for the <code>error</code>.</p></dd>
<dt><code>lambda_min</code></dt><dd><p>Hyperparameter value in <code>lambda</code> that minimizes the SURE
validation error curve.</p></dd>
<dt><code>lambda_1se</code></dt><dd><p>The largest hyperparameter value in <code>lambda</code> that has a
SURE error within one standard error of <code><a href='https://rdrr.io/r/base/Extremes.html'>min(error)</a></code>. We call this the
"1-standard-error rule" hyperparameter, and it serves as an Occam's
razor-esque heuristic. More precisely, given two models with approximately
equal performance (here, in terms of predictive MSE), it may be wise to opt
for the simpler model, i.e. the model with the larger hyperparameter value /
fewer effective degrees of freedom.</p></dd>
<dt><code>edf_min</code></dt><dd><p>Number of effective degrees of freedom in the trend
filtering estimator with hyperparameter <code>lambda_min</code>.</p></dd>
<dt><code>edf_1se</code></dt><dd><p>Number of effective degrees of freedom in the  trend
filtering estimator with hyperparameter <code>lambda_1se</code>.</p></dd>
<dt><code>i_min</code></dt><dd><p>Index of <code>lambda</code> that gives <code>lambda_min</code>.</p></dd>
<dt><code>i_1se</code></dt><dd><p>Index of <code>lambda</code> that gives <code>lambda_1se</code>.</p></dd>
<dt><code>obj_func</code></dt><dd><p>The relative change in the objective function over the
ADMM algorithm's final iteration, for every candidate hyperparameter in
<code>lambda</code>.</p></dd>
<dt><code>n_iter</code></dt><dd><p>Total number of iterations taken by the ADMM algorithm, for
every candidate hyperparameter in <code>lambda</code>. If an element of <code>n_iter</code> is
exactly equal to <code>admm_params$max_iter</code> (see below), then the ADMM algorithm
stopped before reaching the objective tolerance <code>admm_params$obj_tol</code>. In
these situations, you may need to increase the maximum number of tolerable
iterations by passing a <code>max_iter</code> argument to <code><a href='cv_trendfilter.html'>cv_trendfilter()</a></code> in order to
ensure that the ADMM solution has converged to satisfactory precision.</p></dd>
<dt><code>training_error</code></dt><dd><p>The "in-sample" MSE between the observed outputs <code>y</code>
and the trend filtering estimate, for every hyperparameter value in
<code>lambda</code>.</p></dd>
<dt><code>optimism</code></dt><dd><p>SURE-estimated optimisms, i.e.
<code>optimism = error - training_error</code>.</p></dd>
<dt><code>call</code></dt><dd><p>The function call.</p></dd>

</dl>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Our recommendations for when to use <code>sure_trendfilter()</code> versus
<code><a href='cv_trendfilter.html'>cv_trendfilter()</a></code> are summarized in the table below. See Section 3.5 of
<a href='https://arxiv.org/abs/1908.07151'>Politsch et al. (2020a)</a> for more details.</p><table class='table'>
<tr><td>Scenario</td><td>Hyperparameter optimization</td></tr>
<tr><td><code>x</code> is unevenly sampled</td><td><code><a href='cv_trendfilter.html'>cv_trendfilter()</a></code></td></tr>
<tr><td><code>x</code> is evenly sampled and measurement variances for <code>y</code> are not available</td><td><code><a href='cv_trendfilter.html'>cv_trendfilter()</a></code></td></tr>
<tr><td><code>x</code> is evenly sampled and measurement variances for <code>y</code> are available</td><td><code>sure_trendfilter()</code></td></tr>
</table>



<p>For our purposes, an evenly sampled data set with some discarded pixels
(either sporadically or in wide consecutive chunks) is still considered to
be evenly sampled. When <code>x</code> is evenly sampled on a transformed scale, we
recommend transforming to that scale and carrying out the full trend
filtering analysis on that scale. See the <code>sure_trendfilter()</code> examples for
a case when the inputs are evenly sampled on the <code><a href='https://rdrr.io/r/base/Log.html'>log10(x)</a></code> scale.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    
<ol>
<li><p>Politsch et al. (2020a). Trend filtering – I. A modern statistical tool
for time-domain astronomy and astronomical spectroscopy. <em>MNRAS</em>, 492(3),
p. 4005-4018.
[<a href='https://academic.oup.com/mnras/article/492/3/4005/5704413'>Publisher</a>]
[<a href='https://arxiv.org/abs/1908.07151'>arXiv</a>].</p></li>
<li><p>Politsch et al. (2020b). Trend Filtering – II. Denoising astronomical
signals with varying degrees of smoothness. <em>MNRAS</em>, 492(3), p. 4019-4032.
[<a href='https://academic.oup.com/mnras/article/492/3/4019/5704414'>Publisher</a>]
[<a href='https://arxiv.org/abs/2001.03552'>arXiv</a>].</p></li>
</ol>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='st'>"quasar_spectrum"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>quasar_spectrum</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span style='color: #949494;'># A tibble: 6 × 3</span>
#&gt;   log10_wavelength   flux weights
#&gt;              <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span>  <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span>   <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span>
#&gt; <span style='color: #BCBCBC;'>1</span>             3.55  0.424  0.041<span style='text-decoration: underline;'>7</span>
#&gt; <span style='color: #BCBCBC;'>2</span>             3.55 -<span style='color: #BB0000;'>2.11</span>   0.125 
#&gt; <span style='color: #BCBCBC;'>3</span>             3.55 -<span style='color: #BB0000;'>3.78</span>   0.128 
#&gt; <span style='color: #BCBCBC;'>4</span>             3.55  3.60   0.121 
#&gt; <span style='color: #BCBCBC;'>5</span>             3.55 -<span style='color: #BB0000;'>4.89</span>   0.134 
#&gt; <span style='color: #BCBCBC;'>6</span>             3.55  1.76   0.132 </div><div class='input'>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='va'>quasar_spectrum</span><span class='op'>$</span><span class='va'>log10_wavelength</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='va'>quasar_spectrum</span><span class='op'>$</span><span class='va'>flux</span>
<span class='va'>weights</span> <span class='op'>&lt;-</span> <span class='va'>quasar_spectrum</span><span class='op'>$</span><span class='va'>weights</span>

<span class='va'>sure_tf</span> <span class='op'>&lt;-</span> <span class='fu'>sure_trendfilter</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span>, <span class='va'>weights</span><span class='op'>)</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Collin A. Politsch.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


